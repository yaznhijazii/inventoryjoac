<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª - Inventory Team</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'jo-blue': '#00478C',
                    'jo-light-blue': '#00AEEF',
                    'jo-dark-blue': '#003366',
                    'jo-vibrant-blue': '#005a9c',
                    'jo-grey': '#f9fafb',
                    'header-bg': '#1a428a',
                },
            }
        }
    }
</script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<style>
body { font-family:'Cairo','Inter',sans-serif; background:#f9fafb; padding-top:90px; }
.loader { border:4px solid #e5e7eb; border-top:4px solid #00aeef; border-radius:50%; width:24px; height:24px; animation:spin 1s linear infinite; margin-left:10px;}
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
@keyframes pulse-once {0%{transform:scale(1);box-shadow:0 10px 15px -3 rgba(26,66,138,0.4),0 4px 6px -2 rgba(26,66,138,0.4);}50%{transform:scale(1.02);box-shadow:0 20px 25px -5 rgba(26,66,138,0.8),0 10px 10px -5 rgba(26,66,138,0.7);}100%{transform:scale(1);box-shadow:0 10px 15px -3 rgba(26,66,138,0.4),0 4px 6px -2 rgba(26,66,138,0.4);}}
@keyframes slideInUp {0%{opacity:0;transform:translateY(30px);}100%{opacity:1;transform:translateY(0);}}
.hero-animation {animation:slideInUp 1s ease-out forwards; opacity:0;}
.file-input {display:block;width:100%;padding:12px 16px;font-size:14px;border:1px solid #ccc;border-radius:10px;background:white;transition:all 0.3s;}
.file-input::file-selector-button {margin-left:8px;padding:8px 16px;border:0;background:#00478c10;color:#00478C;font-weight:bold;border-radius:6px;cursor:pointer;transition:all 0.3s;}
.ui-card {background:white;border-radius:20px;padding:20px;box-shadow:0 10px 20px rgba(0,0,0,0.05);border-top:4px solid #00aeef;transition:all 0.3s;}
.ui-card:hover {transform:scale(1.01);box-shadow:0 20px 25px rgba(0,0,0,0.1);}
.main-button {width:100%;margin-top:20px;background:linear-gradient(to right,#003366,#005a9c);color:white;font-weight:800;padding:14px;border-radius:16px;font-size:18px;box-shadow:0 10px 20px rgba(0,0,0,0.2);transition:all 0.3s;display:flex;justify-content:center;align-items:center;animation:pulse-once 1.5s ease-in-out 1;}
.main-button:hover {transform:scale(1.02);box-shadow:0 15px 25px rgba(0,0,0,0.25);}
</style>
</head>

<body>

<nav id="main-navbar" class="fixed top-0 w-full z-50 bg-header-bg shadow-md py-4 transition-all">
  <div class="container mx-auto px-4 flex justify-between items-center">
    <div class="text-3xl font-extrabold text-white flex items-center">
      ğŸ“¦ <span class="ml-3">Inventory Team</span>
    </div>
    <div class="hidden md:flex gap-8">
      <a href="#duplicates" class="text-white hover:text-jo-light-blue font-semibold transition-colors border-b-2 border-transparent hover:border-jo-light-blue pb-1">ÙƒØ´Ù Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª</a>
      <a href="#future" class="text-white hover:text-jo-light-blue font-semibold transition-colors border-b-2 border-transparent hover:border-jo-light-blue pb-1">Ø£Ø¯ÙˆØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©</a>
    </div>
  </div>
</nav>

<div class="container mx-auto px-4 py-8">

  <section id="hero-section" class="text-center py-16 rounded-3xl mb-12 bg-white shadow-xl">
    <h1 class="text-5xl font-extrabold text-jo-blue mb-4 leading-tight hero-animation" style="animation-delay:0.2s;">Ø£Ø¯ÙˆØ§Øª ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª</h1>
    <p class="text-xl text-gray-600 font-medium hero-animation" style="animation-delay:0.5s;">ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©: Ø¯Ù‚Ø©ØŒ Ø³Ø±Ø¹Ø©ØŒ ÙˆÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙŠ <span class="text-jo-light-blue font-bold">JO Academy</span>.</p>
  </section>

  <section class="ui-card" id="duplicates">
    <h2 class="text-3xl font-extrabold text-jo-blue mb-8 border-b pb-3 border-jo-blue/10 flex items-center">
      ÙƒØ´Ù Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block mb-2 font-semibold text-gray-700">Ø§Ù„Ù…Ù„Ù (A) - Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ø£ÙˆÙ„</label>
        <input type="file" id="file1" accept=".xlsx,.xls" class="file-input">
      </div>
      <div>
        <label class="block mb-2 font-semibold text-gray-700">Ø§Ù„Ù…Ù„Ù (B) - Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</label>
        <input type="file" id="file2" accept=".xlsx,.xls" class="file-input">
      </div>
    </div>

    <button onclick="processFiles()" class="main-button mt-6">ğŸ” Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>

    <div id="status" class="mt-6 p-4 rounded-lg text-center font-bold hidden"></div>

    <div id="resultsSummary" class="mt-6 p-6 bg-green-50 rounded-xl border border-green-300 shadow-md hidden">
      <h3 class="text-xl font-extrabold text-green-700 mb-4 border-b border-green-200 pb-2">âœ… ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­</h3>
      <div class="grid grid-cols-2 gap-4 text-slate-700">
        <div class="flex flex-col items-start">
          <span class="font-extrabold text-3xl text-red-600" id="orderDupCount">0</span>
          <span class="text-sm font-semibold">ØªÙƒØ±Ø§Ø±Ø§Øª Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</span>
        </div>
        <div class="flex flex-col items-start">
          <span class="font-extrabold text-3xl text-orange-600" id="phoneDupCount">0</span>
          <span class="text-sm font-semibold">ØªÙƒØ±Ø§Ø±Ø§Øª Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</span>
        </div>
      </div>
      <p class="text-xs italic text-gray-500 mt-4 pt-3 border-t border-gray-200">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel Ø§Ù„Ù…ÙØµÙ„ Ù„Ù„ØªÙƒØ±Ø§Ø±Ø§Øª.</p>
    </div>
  </section>

  <section class="ui-card mt-12" id="future">
    <h2 class="text-3xl font-extrabold text-jo-blue mb-4 border-b pb-3 border-jo-blue/10">Ø£Ø¯ÙˆØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h2>
    <p class="text-gray-700 mb-4">Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ø®ØµØµ Ù„Ù„ØªÙˆØ³Ø¹ ÙÙŠ Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª.</p>
    <ul class="list-disc list-inside text-gray-600 space-y-2">
      <li><span class="font-semibold">Ù…Ù‚Ø§Ø±Ù†Ø© ÙØªØ±Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:</span> Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø¬Ø±Ø¯ÙŠÙ†.</li>
      <li><span class="font-semibold">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰:</span> ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¢Ù„ÙŠØ© Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ ØµÙ†Ù Ù…Ø¹ÙŠÙ† Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰.</li>
      <li><span class="font-semibold">ØªÙ‚Ø§Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡:</span> Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ø£Ø¯Ø§Ø¡ ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.</li>
    </ul>
  </section>

</div>

<footer class="bg-white py-6 mt-16 shadow-inner border-t-2 border-jo-light-blue/20">
  <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
    <p class="text-jo-blue font-bold">Made with â¤ï¸ by the Automation Team, led by Yazan Hijazi.</p>
    <p class="mt-1 text-xs text-jo-blue/80">ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª JO Academy &copy; <script>document.write(new Date().getFullYear())</script></p>
  </div>
</footer>

<script>
// ØªØ·Ø¨ÙŠØ¹ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
function normalizeJordanianPhone(phone) {
    if(!phone) return null;
    phone = phone.toString().replace(/[^0-9+]/g,'');
    if(phone.startsWith("00")) phone = "+"+phone.slice(2);
    if(phone.startsWith("962") && !phone.startsWith("+")) phone = "+"+phone;
    if(phone.startsWith("07") && phone.length===10) phone = "+962"+phone.slice(1);
    if(phone.startsWith("7") && phone.length===9) phone = "+962"+phone;
    if(!phone.startsWith("+962")) return null;
    return phone.slice(0,13);
}

// Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„ÙØ§Øª Excel
function readExcel(file){
    return new Promise((resolve,reject)=>{
        const reader=new FileReader();
        reader.onload=e=>{
            try{
                const data=new Uint8Array(e.target.result);
                const workbook=XLSX.read(data,{type:'array',cellDates:true});
                const sheet=workbook.Sheets[workbook.SheetNames[0]];
                const json=XLSX.utils.sheet_to_json(sheet,{defval:"",raw:true});
                resolve(json);
            } catch(err){reject(err);}
        };
        reader.onerror=()=>reject(new Error("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù."));
        reader.readAsArrayBuffer(file);
    });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
function showMessage(type,message){
    const statusEl=document.getElementById("status");
    statusEl.classList.remove('hidden','bg-red-100','text-red-700','bg-green-100','text-green-700','bg-yellow-100','text-yellow-700');
    let classes=''; let icon='';
    if(type==='success'){classes='bg-green-100 text-green-700 border border-green-300'; icon='âœ…';}
    else if(type==='error'){classes='bg-red-100 text-red-700 border border-red-300'; icon='âŒ';}
    else if(type==='info'){classes='bg-yellow-100 text-yellow-700 border border-yellow-300'; icon='<span class="loader"></span>';}
    statusEl.className=`mt-6 p-4 rounded-lg text-center font-bold flex items-center justify-center ${classes}`;
    statusEl.innerHTML=`${icon} <span>${message}</span>`;
}

// Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
async function processFiles(){
    const f1=document.getElementById("file1").files[0];
    const f2=document.getElementById("file2").files[0];
    if(!f1||!f2){showMessage('error','Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙƒÙ„Ø§ Ø§Ù„Ù…Ù„ÙÙŠÙ† Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©.'); return;}
    showMessage('info','Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...');
    try{
        const dfs=await Promise.all([readExcel(f1),readExcel(f2)]);
        let df=dfs[0].concat(dfs[1]);
        df.forEach(r=>r.PhoneNumSMS_Normalized=normalizeJordanianPhone(r.PhoneNumSMS));
        let orderIDs={};
        df.forEach(r=>{
            const id=r["Order ID"]; if(!id) return;
            if(!orderIDs[id]) orderIDs[id]=[];
            orderIDs[id].push(r);
        });
        let ordersResult=[]; let orderDupCount=0;
        Object.keys(orderIDs).forEach(id=>{
            const records=orderIDs[id];
            if(records.length<=1) return;
            const allSuccess=records.every(r=>r.Stage && r.Stage.toString().toLowerCase()==='success');
            if(allSuccess) return; // ØªØ¬Ø§Ù‡Ù„ Ù„Ùˆ ÙƒÙ„Ù‡Ù… Success
            orderDupCount++;
            let header={}; Object.keys(df[0]).forEach(k=>header[k]="");
            header["Order ID"]=`==== ORDER ID DUPLICATE: ${id} (${records.length} ENTRIES) ====`;
            ordersResult.push(header); ordersResult=ordersResult.concat(records);
        });

        // Ø§Ù„Ù‡ÙˆØ§ØªÙ
        let phones={};
        df.forEach(r=>{
            const phone=r.PhoneNumSMS_Normalized;
            if(!phone) return;
            if(!phones[phone]) phones[phone]=[];
            phones[phone].push(r);
        });
        let phonesResult=[]; let phoneDupCount=0;
        Object.keys(phones).forEach(phone=>{
            if(phones[phone].length>1){phoneDupCount++; let header={}; Object.keys(df[0]).forEach(k=>header[k]=""); header["PhoneNumSMS_Normalized"]=`==== PHONE DUPLICATE: ${phone} (${phones[phone].length} ENTRIES) ====`; phonesResult.push(header); phonesResult=phonesResult.concat(phones[phone]);}
        });

        const wb=XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(ordersResult.length>0?ordersResult:[{"Ø±Ø³Ø§Ù„Ø©":"Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙƒØ±Ø§Ø±Ø§Øª ÙÙŠ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª"}]),"Duplicates_By_OrderID");
        XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(phonesResult.length>0?phonesResult:[{"Ø±Ø³Ø§Ù„Ø©":"Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙƒØ±Ø§Ø±Ø§Øª ÙÙŠ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ"}]),"Duplicates_By_Phone");
        const wbout=XLSX.write(wb,{bookType:'xlsx',type:'array'});
        saveAs(new Blob([wbout],{type:"application/octet-stream"}),`JO_Inventory_Duplicates_Report_${new Date().toISOString().slice(0,10).replace(/-/g,'')}.xlsx`);

        document.getElementById("orderDupCount").innerText=orderDupCount;
        document.getElementById("phoneDupCount").innerText=phoneDupCount;
        document.getElementById("resultsSummary").classList.remove('hidden');
        showMessage('success',`ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­! ØªÙ… ÙƒØ´Ù ${orderDupCount} ØªÙƒØ±Ø§Ø± Ø·Ù„Ø¨ Ùˆ ${phoneDupCount} ØªÙƒØ±Ø§Ø± Ù‡Ø§ØªÙ.`);

    } catch(err){console.error(err); showMessage('error','Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: '+err.message);}
}

// Shrinking header effect
document.addEventListener('DOMContentLoaded',()=>{
    const navbar=document.getElementById('main-navbar');
    const links=navbar.querySelectorAll('a');
    function handleScroll(){
        if(window.scrollY>100){navbar.classList.add('py-3','shadow-2xl'); navbar.classList.remove('py-4','shadow-md');}
        else{navbar.classList.add('py-4','shadow-md'); navbar.classList.remove('py-3','shadow-2xl');}
        links.forEach(a=>a.classList.add('text-white','hover:text-jo-light-blue'));
    }
    window.addEventListener('scroll',handleScroll);
    handleScroll();
});
</script>

</body>
</html>
